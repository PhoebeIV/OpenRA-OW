^AvaliBuilding:
	Building:
		BuildSounds: pbldgplc.aud, constru2.aud

AVFACT:
	Inherits: FACTD
	Selectable:
		Bounds: 3072, 3072
	D2kBuilding:
		BuildSounds: placbldg.aud, build5.aud
		LocalCenterOffset: 0,0,0
	Tooltip:
		Name: actor-avfact-name
	SpawnActorsOnSell:
		ActorTypes: avinf1,avinf1,avinf1,tecn,tecn2
		GuaranteedActorTypes: avinf1, avinf2
	Transforms:
		RequiresCondition: factundeploy && !bot_undeploy_block
		PauseOnCondition: chrono-vortex || being-captured || being-demolished || build-incomplete
		IntoActor: avmcv
		Offset: 1,1
		Facing: 0
	GrantConditionOnTileSet@snow:
		TileSets: SNOW
		Condition: no_gen
	ProvidesPrerequisite@snow:
		Prerequisite: structures.snowgen
		RequiresCondition: !no_gen
	-RenderSprites:
	RenderSprites:
	-WithDeathAnimation:
	-WithIdleOverlay@soviet:
	Cloak@stealthgen:
		Palette: cloak

^AvaliPowerPlant:
	Inherits@avali: ^AvaliBuilding
	GrantConditionOnTerrain@buffsnow:
		TerrainTypes: ClearSnow
		Condition: env_buffsnow
	GrantConditionOnTileSet@warm:
		TileSets: TEMPERAT, INTERIOR, DESERT
		Condition: env_buff
	PowerMultiplier@warm:
		Modifier: 110
		RequiresCondition: env_buff && !env_buffsnow

AVPOWR1:
	Inherits: ^PowerPlant
	Inherits@power: ^AvaliPowerPlant
	Inherits@POWER_OUTAGE: ^DisabledByPowerOutage
	Inherits@shape: ^1x1Shape
	Selectable:
		Bounds: 1028, 1028
	HitShape:
		UseTargetableCellsOffsets: false
	Buildable:
		Queue: Building
		BuildPaletteOrder: 1
		Prerequisites: ~structures.avalon, ~techlevel.infonly, ~!ai.powerout
		Description: actor-avpowr1.description
	Valued:
		Cost: 300
	Tooltip:
		Name: actor-avpowr1.name
	ProvidesPrerequisite:
		Prerequisite: anypower
	Building:
		Footprint: +
	Health:
		HP: 36000
	Armor:
		Type: Wood
	RevealsShroud:
		Range: 4c0
	Power:
		Amount: 100
	Targetable:
		TargetTypes: GroundActor, Structure, C4, DetonateAttack, SpyInfiltrate
	FireWarheadsOnDeath:
		Weapon: AvaliPowerExplosion
		EmptyWeapon: AvaliPowerExplosion
		RequiresCondition: avpowernear < 3
	FireWarheadsOnDeath@big:
		Weapon: DemoTrapExplosion2
		EmptyWeapon: DemoTrapExplosion2
		RequiresCondition: avpowernear >= 3
	ExternalCondition@avpowernear:
		Condition: avpowernear
	ProximityExternalCondition@avpowernear:
		Condition: avpowernear
		Range: 1c256
		AffectsParent: false
	PowerMultiplier@warm:
		RequiresCondition: env_buff && !avpowernear && !env_buffsnow
	Power@bonus1:
		RequiresCondition: (avpowernear == 1) && !env_buff
		Amount: 10
	Power@bonus1e:
		RequiresCondition: (avpowernear == 1) && env_buff && !env_buffsnow
		Amount: 20
	Power@bonus2:
		RequiresCondition: (avpowernear == 2) && !env_buff
		Amount: 25
	Power@bonus2e:
		RequiresCondition: (avpowernear == 2) && env_buff && !env_buffsnow
		Amount: 30
	Power@bonus3:
		RequiresCondition: (avpowernear >= 3) && !env_buff
		Amount: 40
	Power@bonus3e:
		RequiresCondition: (avpowernear >= 3) && env_buff && !env_buffsnow
		Amount: 50
	WithBuildingBib:
		HasMinibib: true
	ProximityExternalCondition@powered:
		Range: 2c0


AVPOWR2:
	Inherits: ^PowerPlant
	Inherits@power: ^AvaliPowerPlant
	Inherits@POWER_OUTAGE: ^DisabledByPowerOutage
	Inherits@shape: ^2x2Shape
	Inherits@BIB: ^2xBuildingBib
	Selectable:
		Bounds: 2048, 2048
	HitShape:
		UseTargetableCellsOffsets: false
		TargetableOffsets: 0,0,0, 640,-384,0, 640,512,0, -710,-512,0, -710,512,0
	Buildable:
		Queue: Building
		BuildPaletteOrder: 110
		Prerequisites: radar, ~techlevel.medium, ~structures.avalon, ~!ai.powerout
		Description: actor-avpowr2.description
	Valued:
		Cost: 600
	Tooltip:
		Name: actor-avpowr2.name
	ProvidesPrerequisite:
		Prerequisite: anypower
	ProvidesPrerequisite@grade:
		Prerequisite: power.grade1
	Building:
		Footprint: xX xx ==
		Dimensions: 2,3
		LocalCenterOffset: 0,-512,0
	Health:
		HP: 65000
	Armor:
		Type: Wood
	RevealsShroud:
		Range: 5c0
	Power:
		Amount: 200
	Targetable:
		TargetTypes: GroundActor, Structure, C4, DetonateAttack, SpyInfiltrate
	GrantConditionOnDamageState@fire2:
		Condition: damaged_heavy
		ValidDamageStates: Heavy, Critical
	WithIdleOverlay@fire3:
		RequiresCondition: damaged_heavy
		Image: fire
		Sequence: 2
		IsDecoration: true
		Offset: 0,-1024,512
		Palette: effect

AVPOWR3:
	Inherits: XPWR
	Inherits@1: ^AvaliPowerPlant
	Selectable:
		Bounds: 3072, 2048
	Buildable:
		Prerequisites: advtechcenter, ~techlevel.unrestricted, ~structures.avalon, ~!ai.god, ~!ai.powerout
		Description: actor-avpowr3.description
	Building:
		Footprint: xxx xxx ===
		Dimensions: 3,3
		LocalCenterOffset: 0,-512,0
	Tooltip:
		Name: actor-avpowr3.name
	WithIdleOverlay:
		StartSequence: fire-start
		Sequence: fire-loop
	-RenderSprites:
	-WithDeathAnimation:
	RenderSprites:

AVPROC:
	Inherits: PROC
	Inherits@avali: ^AvaliBuilding
	Buildable:
		Prerequisites: anypower, ~techlevel.infonly, ~structures.avalon, ~!ai.god
	Tooltip:
		Name: actor-avproc-name
	FreeActor:
		Actor: AVHARV
	-GrantConditionOnFaction:
	-WithIdleOverlay@uac:

AVTENT:
	Inherits: TENT
	Inherits@avali: ^AvaliBuilding
	Inherits@BIB: ^3xBuildingBib
	Inherits@SHAPE: ^3x2Shape
	Selectable:
		Bounds: 3072, 2048
	HitShape:
		UseTargetableCellsOffsets: true
		-TargetableOffsets:
	Buildable:
		Prerequisites: anypower, ~structures.avalon, ~techlevel.infonly, ~!structures.bothard
		Description: actor-avtent.description
	Tooltip:
		Name: actor-avtent.name
	Building:
		Dimensions: 3,3
		Footprint: =x= xxx ===
	-Exit@1:
	Exit@2:
		RequiresCondition: !being-captured
		SpawnOffset: -725,640,0
		ExitCell: 0,2
		ProductionTypes: Soldier, Infantry
	RenderSprites:
		Image: AVTENT
	GrantConditionOnDamageState@fire2:
		Condition: damaged_heavy
		ValidDamageStates: Heavy, Critical
	WithIdleOverlay@fire3:
		RequiresCondition: damaged_heavy
		Image: fire
		Sequence: 2
		IsDecoration: true
		Offset: 0,0,256
		Palette: effect

AVWEAP:
	Inherits: WEAP
	Inherits@avali: ^AvaliBuilding
	Buildable:
		Queue: Building
		Prerequisites: refinery, barracks, ~techlevel.low, ~structures.avalon, ~!structures.bothard
	Tooltip:
		Name: actor-avweap-name

AVRADAR:
	Inherits: ^Building
	Inherits@avali: ^AvaliBuilding
	Inherits@IDISABLE: ^DisableOnLowPowerOrPowerDown
	Inherits@shape: ^2x2Shape
	Inherits@BIB: ^2xBuildingBib
	Selectable:
		Bounds: 2048, 2048
	HitShape:
		UseTargetableCellsOffsets: false
		TargetableOffsets: 0,0,0, 630,-384,0, 630,384,0, -700,-512,0, -700,512,0
	Buildable:
		Queue: Building
		BuildPaletteOrder: 90
		Prerequisites: refinery, ~techlevel.medium, ~structures.avalon
		Description: actor-avradar.description
	Valued:
		Cost: 1800
	Tooltip:
		Name: actor-avradar.name
	Building:
		Footprint: x_ xx ==
		Dimensions: 2,3
		LocalCenterOffset: 0,-512,0
	Targetable:
		TargetTypes: GroundActor, Structure, C4, DetonateAttack, SpyInfiltrate
	Health:
		HP: 100000
	Armor:
		Type: Wood
	RevealsShroud:
		MinRange: 6c0
		Range: 10c0
		RequiresCondition: !disabled
		RevealGeneratedShroud: False
	RevealsShroud@Offline:
		Range: 5c0
		RequiresCondition: disabled
	RevealsShroud@GAPGEN:
		Range: 6c0
		RequiresCondition: !disabled
	WithSpriteBody:
		PauseOnCondition: disabled || jammed
	ProvidesRadar:
		RequiresCondition: !jammed && !disabled
	InfiltrateForExploration:
		Types: SpyInfiltrate
	Power:
		Amount: -40
	ProvidesPrerequisite@buildingname:
	ProvidesPrerequisite:
		Prerequisite: radar
	ExternalCondition@JAMMED:
		Condition: jammed
	WithDeathAnimation:
		DeathSequence: dead
		UseDeathTypeSuffix: false
	AirstrikePower@avali:
		PauseOnCondition: disabled
		OrderName: AvaliAirstrike
		Prerequisites: techlevel.high
		Icon: parabombs
		ChargeInterval: 7500
		Name: Airstrike
		Description: An Illuminate squadron drops plasma bombs on your target.
		SelectTargetSpeechNotification: SelectTarget
		CameraActor: camera
		CameraRemoveDelay: 150
		UnitType: avbomber.bomber
		QuantizedFacings: 8
		DisplayBeacon: true
		BeaconPoster: pbmbicon
		SquadSize: 2
		SquadOffset: 1024,1024,0
		ArrowSequence: arrow
		ClockSequence: clock
		CircleSequence: circles
		UseDirectionalTarget: True
		DirectionArrowAnimation: paradirection
		SupportPowerPaletteOrder: 40

AVPAD:
	Inherits: HPAD
	Inherits@avali: ^AvaliBuilding
	Selectable:
		Bounds: 2048, 2048
	Buildable:
		Queue: Building
		BuildPaletteOrder: 120
		Prerequisites: radar, ~structures.avalon, ~techlevel.medium, ~!ai.hard
		Description: actor-avpad.description
	Valued:
		Cost: 500
	Tooltip:
		Name: actor-avpad.name
	Building:
		Footprint: xx xx ==
		Dimensions: 2,3
		LocalCenterOffset: 0,-512,0
	Health:
		HP: 80000

AVTECH:
	Inherits: ^ScienceBuilding
	Inherits@TECH: ^TechCenter
	Inherits@avali: ^AvaliBuilding
	Inherits@IDISABLE: ^DisableOnLowPower
	Inherits@shape: ^2x2Shape
	Inherits@BIB: ^2xBuildingBib
	Selectable:
		Bounds: 2048, 2048
	Buildable:
		Queue: Building
		BuildPaletteOrder: 140
		Prerequisites: factory, radar, ~structures.avalon, ~techlevel.high
		Description: actor-avtech.description
	Tooltip:
		Name: actor-avtech.name
	Building:
		Footprint: xx xx ==
		Dimensions: 2,3
		LocalCenterOffset: 0,-512,0
	Health:
		HP: 60000
	Armor:
		Type: Wood
	RevealsShroud:
		MinRange: 4c0
		Range: 5c0
		RevealGeneratedShroud: False
	RevealsShroud@GAPGEN:
		Range: 4c0
	InfiltrateForSupportPowerReset:
		Types: SpyInfiltrate
		PlayerExperience: 10
	Targetable:
		TargetTypes: GroundActor, C4, DetonateAttack, Structure, SpyInfiltrate
	ProvidesPrerequisite@buildingname:

AVFROST:
	Inherits: ^Building
	Inherits@avali: ^AvaliBuilding
	Inherits@IDISABLE: ^DisableOnLowPowerOrPowerDown
	Valued:
		Cost: 400
	Buildable:
		Queue: Wall
		BuildPaletteOrder: 100
		Prerequisites: anypower, ~structures.avalon, ~techlevel.low, ~structures.snowgen
		Description: actor-avfrost.description
	Tooltip:
		Name: actor-avfrost.name
	Power:
		Amount: -20
	Health:
		HP: 40000
	Armor:
		Type: Wood
	RevealsShroud:
		MinRange: 3c0
		Range: 4c0
		RevealGeneratedShroud: False
	RevealsShroud@GAPGEN:
		Range: 3c0
	SeedsResource@frost:
		ResourceType: AvaliSnow
		Interval: 4
		MaxRange: 9
		RequiresCondition: !disabled
	-AcceptsDeliveredCash:
	FireWarheadsOnDeath@frost:
		Weapon: FrostRemoveMed
		-RequiresCondition:
	FireWarheads:
		RequiresCondition: selling
		Weapons: FrostRemoveMed
		Interval: 50
	ProximityExternalCondition:
		RequiresCondition: !disabled
		Condition: creepgen
		Range: 9c0
		ValidRelationships: Neutral, Ally, Enemy

AVPBOX:
	Inherits: PBOX
	Inherits@avali: ^AvaliBuilding
	Tooltip:
		Name: actor-avpbox.name
	Buildable:
		Queue: Defense
		BuildPaletteOrder: 40
		Prerequisites: barracks, ~structures.avalon, ~techlevel.low
		Description: actor-avpbox.description
	Cargo:
		Types: Infantry
		MaxWeight: 1
		InitialUnits: avinf1

AVTOWR:
	Inherits: ^Defense
	Inherits@avali: ^AvaliBuilding
	Inherits@IDISABLE: ^DisableOnLowPowerOrPowerDown
	Inherits@AUTOTARGET: ^AutoTargetAll
	Valued:
		Cost: 700
	Tooltip:
		Name: actor-avtowr.name
	Buildable:
		BuildPaletteOrder: 60
		Prerequisites: radar, ~structures.avalon, ~techlevel.medium
		Queue: Defense
		Description: actor-avtowr.description
	Selectable:
		Bounds: 1024, 1024
		DecorationBounds: 938, 2048, 0, -512
	SelectionDecorations:
	Health:
		HP: 40000
	Armor:
		Type: Heavy
	RevealsShroud:
		MinRange: 5c0
		Range: 8c0
		RevealGeneratedShroud: False
	RevealsShroud@GAPGEN:
		Range: 5c0
	WithBuildingBib:
		HasMinibib: true
	Turreted:
		TurnSpeed: 1023
		Offset: 128,128,384
	Armament@SECONDARY:
		Weapon: AvaliTowerAAMissile
		LocalOffset: 256,128,0, 256,-128,0
		LocalYaw: -100,100
	AttackTurreted:
		RequiresCondition: !build-incomplete
		PauseOnCondition: lowpower || disabled
	-BodyOrientation:
	ClassicFacingBodyOrientation:
		QuantizedFacings: 8
	DetectCloaked:
		Range: 6c0
		RequiresCondition: !lowpower
		DetectionTypes: Cloak, AirCloak
	Power:
		Amount: -50

AVGUN:
	Inherits: ^Defense
	Inherits@avali: ^AvaliBuilding
	Inherits@AUTOTARGET: ^AutoTargetGround
	Inherits@AUTOTARGETGround: ^AutoTargetVehiclePriority
	Buildable:
		Queue: Defense
		BuildPaletteOrder: 70
		Prerequisites: barracks, ~structures.avalon, ~techlevel.medium
		Description: actor-avgun.description
	Valued:
		Cost: 800
	Tooltip:
		Name: actor-avgun.name
	Building:
	Health:
		HP: 50000
	Armor:
		Type: Heavy
	RevealsShroud:
		MinRange: 5c0
		Range: 6c512
		RevealGeneratedShroud: False
	RevealsShroud@GAPGEN:
		Range: 5c0
	WithBuildingBib:
		HasMinibib: true
	Turreted:
		TurnSpeed: 48
		InitialFacing: 192
		RealignDelay: -1
		RequiresCondition: !build-incomplete
	WithSpriteTurret:
		RequiresCondition: !build-incomplete
		Recoils: false
	WithTurretAttackAnimation:
		Sequence: recoil
	Armament:
		Weapon: AvaliTurretGun
		LocalOffset: 512,0,112
		MuzzleSequence: avmuzzle
	AttackTurreted:
		PauseOnCondition: build-incomplete
	WithMuzzleOverlay:
	Power:
		Amount: -30
	DetectCloaked:
		Range: 6c0
		DetectionTypes: Cloak, AirCloak
	-BodyOrientation:
	ClassicFacingBodyOrientation:

AVDEFNODE:
	Inherits: ^Building
	Inherits@avali: ^AvaliBuilding
	Inherits@superweapon: ^Superweapon
	Inherits@IDISABLE: ^DisableOnLowPowerOrPowerDown
	Inherits@shape: ^2x2Shape
	Valued:
		Cost: 5000
	Buildable:
		Queue: Tech
		BuildPaletteOrder: 9001
		BuildLimit: 1
		Prerequisites: advtechcenter, ~structures.avalon, ~techlevel.unrestricted
		Description: actor-avdefnode.description
	Tooltip:
		Name: actor-avdefnode.name
	Building:
		Footprint: ++ xx
		Dimensions: 2,2
		UndeploySounds: radaron2.aud
	Selectable:
		Bounds: 2048, 2133, 0, -170
	Power:
		Amount: -300
	Power@active:
		RequiresCondition: activated
		Amount: -1000
	Health:
		HP: 300000
	Armor:
		Type: Wood
	RevealsShroud:
		Range: 5c0
	ToggleConditionOnOrder:
		RequiresCondition: !activated
	GrantDelayedCondition:
		RequiresCondition: !activated
		PauseOnCondition: disabled
		Condition: charged
		RevokeOnDisabled: true
		Delay: 13500
	SupportPowerChargeBar:
		Color: FF0000
	ProduceActorPower:
		Name: actor-avdefnode.name
		RequiresCondition: !activated
		PauseOnCondition: charged || disabled
		Description: actor-avdefnode.description
		Icon: protossshields
		Actors: c1
		Type: NoType
		ChargeInterval: 13500
		InsufficientPowerSpeechNotification: InsufficientPower
		BeginChargeSpeechNotification: IronCurtainCharging
		EndChargeSpeechNotification: IronCurtainReady
		SelectTargetTextNotification: notification-select-target
		InsufficientPowerTextNotification: notification-insufficient-power
		BeginChargeTextNotification: notification-iron-curtain-charging
		EndChargeTextNotification: notification-iron-curtain-ready
		OrderName: AvaliDefenseNode
		SupportPowerPaletteOrder: 1
		DisplayTimerRelationships: Ally, Enemy, Neutral
	GrantConditionOnDamage@superweapon:
		RequiresCondition: charged && !disabled
		DamageTypes: Superweapon
		Condition: activated
		ValidRelationships: Neutral, Enemy, Ally
		Duration: 999
	WithIdleOverlay@charged:
		Sequence: active
		RequiresCondition: charged
	FireWarheads@activated:
		RequiresCondition: activated
		Interval: 90000
		Weapons: AvaliDefenseNodeEffect
	FireWarheads@activatedEMP:
		RequiresCondition: activated
		StartCooldown: 5
		Interval: 90000
		Weapons: EMPWeapon
	GrantCondition@transform:
		RequiresCondition: activated
		GrantPermanently: true
		Condition: start_transform
	GrantCondition@disableme:
		RequiresCondition: start_transform
		Condition: disabled
	GrantDelayedCondition@transform:
		Condition: do_transform
		RequiresCondition: start_transform
		Delay: 1000
	TransformOnCondition@transform:
		RequiresCondition: do_transform
		IntoActor: AVDEFNODE
	AmbientSound@lowpower:
		SoundFiles: buzzy1.aud
		RequiresCondition: start_transform
		Interval: 30

AVLPOST:
	Inherits: ^Building
	Inherits@IDISABLE: ^DisableOnLowPowerOrPowerDown
	Buildable:
		Queue: Wall
		BuildPaletteOrder: 30
		Prerequisites: anypower, barracks, ~structures.avalon, ~techlevel.low
		Description: actor-avlpost.description
	Valued:
		Cost: 200
	Tooltip:
		Name: actor-avlpost.name
	Health:
		HP: 30000
	Armor:
		Type: Concrete
	LineBuild:
		Range: 10
		NodeTypes: avalifencenode
		SegmentType: avlfence
		SegmentsRequireNode: true
	LineBuildNode:
		Types: avalifencenode
	Power:
		Amount: -25
	RevealsShroud:
		Range: 4c0
	LineBuildSegmentExternalCondition:
		RequiresCondition: !build-incomplete && !disabled
		Condition: active-posts
	-WithSpriteBody:
	-WithMakeAnimation:
	ExternalCondition:
		Condition: nearlaserfence
	ProximityExternalCondition@gates:
		Range: 2c600
		Condition: nearlaserfencepost
	WithWallSpriteBody:
		Type: laserfence
	RenderSprites:
		Image: brik2

AVLFENCE:
	Inherits: ^Wall
	Tooltip:
		Name: actor-avlpost.node
	LineBuild:
		NodeTypes: avalifence
	LineBuildNode:
		Types: avalifence
	-Crushable:
	-Sellable:
	Targetable:
		TargetTypes: Ground, GroundActor, NoAutoTarget, NoAITarget
	-Building:
	EnergyWall:
		ActiveCondition: active-posts == 2
		Weapon: TeslaZap
		TerrainTypes: Clear, Rough, Road, ClearSnow
	RequiresBuildableArea:
		Adjacent: 4
	GrantConditionOnLineBuildDirection@X:
		Direction: X
		Condition: laserfence-direction-x
	GrantConditionOnLineBuildDirection@Y:
		Direction: Y
		Condition: laserfence-direction-y
	Power:
		Amount: -5
		RequiresCondition: active-posts == 2
	-WithWallSpriteBody:
	ExternalCondition@ACTIVE:
		Condition: active-posts
	WithWallSpriteBody@XENABLED:
		RequiresCondition: laserfence-direction-x && active-posts == 2
		Type: laserfence
		Sequence: enabled-x
		Name: x-enabled
	WithWallSpriteBody@YENABLED:
		RequiresCondition: laserfence-direction-y && active-posts == 2
		Type: laserfence
		Sequence: enabled-y
		Name: y-enabled
	WithSpriteBody@XDISABLED:
		RequiresCondition: laserfence-direction-x && active-posts < 2
		Sequence: disabled-x
		Name: x-disabled
	WithSpriteBody@YDISABLED:
		RequiresCondition: laserfence-direction-y && active-posts < 2
		Sequence: disabled-y
		Name: y-disabled
	BlocksProjectiles:
		RequiresCondition: active-posts == 2
		ValidRelationships: Enemy, Neutral
	DamageMultiplier: # Prevent all normal damage, but still allows direct kills from the post
		Modifier: 0
	-SoundOnDamageTransition:
	FireWarheadsOnDeath:
		Weapon: UnitExplodeSmall
		EmptyWeapon: UnitExplodeSmall
		Type: Footprint
	ProximityExternalCondition@wall:
		Range: 512
		Condition: nearlaserfence
		RequiresCondition: active-posts == 2
	FreeActor:
		RequiresCondition: active-posts == 2
		AllowRespawn: true
		Actor: AVLFENCE.Light
	Interactable:
		Bounds: 1448, 1448

AVLFENCE.Light:
	Inherits: MINE_DUMMY
	ExternalCondition:
		Condition: nearlaserfence
	KillsSelf:
		RequiresCondition: !nearlaserfence
		Delay: 2
		RemoveInstead: true
	TerrainLightSource:
		Range: 1c512
		Intensity: 0.1
		RedTint: 0.25
		GreenTint: 0.10
		BlueTint: 0.0
